<!--suppress HtmlUnknownTarget -->
<template>
	<div class="page" data-name="calendar">

		<!-- Top Navbar -->
		<div class="navbar navbar-collapse">
			<div class="navbar-bg"></div>
			<div class="navbar-inner sliding">
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="">Назад</span>
					</a>
				</div>
				<div class="title">{{title}} в {{year}} году</div>
				<div class="right">
				{{> "navbar-right"}}
				</div>
			</div>
		</div>

		<!-- Scrollable page content-->
		<div class="page-content">
			<div class="page-title">
				{{title}} в {{year}} году
			</div>
			{{#if description}}
			<div class="block text-white">
				{{description}}
			</div>
			{{/if}}
			<div class="tile">
				{{> "calendar-holidays-list"}}
			</div>
		</div>
	</div>
</template>
<!--suppress JSAnnotator -->
<script>
	import {
		format,
		parse,
		addDays,
		subDays,
		endOfWeek,
		getEaster,
		isLeapYear
	} from '../js/utils/date-utils.js';

	export default {
		on: {
			pageAfterIn: function(e, page) {
				// if(this.$root.debug)
				// 	this.$router.navigate('/days/20190428', {});
			}
		},
		data() {
			let year = this.$route.params.year || format(new Date(), 'YYYY');
			let type = this.$route.params.type;

			return getData(type, year);
		}
	}

	/**
	 * Дата после Пасхи в формате YYYYMMDD
	 * @param  {string} year Год
	 * @param  {number} days Кол-во дней после Пасхи
	 * @return {string}
	 */
	function afterEaster(year, days) {
		return format(addDays(getEaster(year), days));
	}

	/**
	 * Дата перед Пасхой в формате YYYYMMDD
	 * @param  {string} year Год
	 * @param  {number} days Кол-во дней перед Пасхой
	 * @return {string}
	 */
	function beforeEaster(year, days) {
		return format(subDays(getEaster(year), days));
	}

	/**
	 * Первое воскресение после указанной даты в формате YYYYMMDD
	 * @param  {string} date Дата в формате YYYYMMDD
	 * @return {string}      [description]
	 */
	function formatEndOfWeek(date) {
		return format(endOfWeek(parse(date)));
	}

	/**
	 * Дата в формате YYYYMMDD в зависимости от вискосного года
	 * @param  {string} year        Год
	 * @param  {string} month       Месяц
	 * @param  {string} day         День
	 * @param  {string} leapYearDay День в високосный год
	 * @return {string}
	 */
	function dateLeapYear(year, month, day, leapYearDay) {
		return `${year}${month}${isLeapYear(new Date(year, 1, 1)) ? leapYearDay : day}`;
	}


	function getData(type, year) {
		let data;

		switch (type) {
			case 'twelve':
			data = {
				title: 'Двунадесятые праздники',
				description: `
					Двунадесятые праздники – двенадцать важнейших после Пасхи церковных праздников.
					Посвящены событиям земной жизни Спасителя и Богородицы.
					В богослужебных книгах отмечаются знаком красного креста в круге.
					У каждого из них существует предпразднство, попразднство и отдание.
				`,
				holidays: [
					{
						name: "Двунадесятые переходящие праздники",
						desc: "Отсчитываются от Пасхи и перемещаются в пространстве «светского» календаря вместе с ней.",
						items: {
							[beforeEaster(year, 7)]: "Вход Господень в Иерусалим",
							[afterEaster(year, 39)]: "Вознесение Господне",
							[afterEaster(year, 49)]: "День Святой Троицы. Пятидесятница"
						}
					},
					{
						name: "Двунадесятые непереходящие праздники",
						desc: "Всегда приходятся на строго определенное число месяца, вне зависимости от дня недели, ежегодно меняющегося.",
						items: {
							[`${year}0119`]: "Крещение Господне. Богоявление",
							[`${year}0215`]: "Сретение Господне",
							[`${year}0407`]: "Благовещение Пресвятой Богородицы",
							[`${year}0819`]: "Преображение Господне",
							[`${year}0828`]: "Успение Пресвятой Богородицы",
							[`${year}0921`]: "Рождество Пресвятой Богородицы",
							[`${year}0927`]: "Воздвижение Креста Господня",
							[`${year}1204`]: "Введение во храм Пресвятой Богородицы",
							[`${year}0107`]: "Рождество Христово"
						}
					}
				]
			};
			break;

			case 'grand':
			data = {
				title: 'Великие праздники',
				description: `
				В день великого праздника совершается Всенощное бдение.
				В богослужебных книгах отмечаются знаком красного креста в круге.
				У великих недвунадесятых праздников предпразднства, попразднства и отдания нет.
				`,
				holidays: [
					{
						items: {
							[`${year}0114`]: "Обрезание Господне и память святителя Василия Великого",
							[`${year}0707`]: "Рождество Иоанна Предтечи",
							[`${year}0712`]: "святых первоверховных апостолов Петра и Павла",
							[`${year}0911`]: "Усекновение главы Иоанна Предтечи",
							[`${year}1014`]: "Покров Пресвятой Богородицы"
						}
					}
				]
			};
			break;

			case 'valaam':
			data = {
				title: 'Праздники Валаамской обители',
				description: `
				Памяти икон Пресвятой Богородицы и святых, особо почитаемые на Валааме.
				`,
				holidays: [{
					items: {
						// Первое воскресение после прпп. Сергия и Германа Валаамских (11 июля)
						[formatEndOfWeek(`${year}0713`)]: "Валаамской иконы Божией Матери",
						// Первое воскресение после Преображения (19 августа)
						[formatEndOfWeek(`${year}0820`)]: "Собор Всех Валаамских святых",
						[`${year}1213`]: "День возрождения Валаамского монастыря",
						[`${year}1111`]: "Прп. Авраамий Ростовский",
						[`${year}0711`]: "Прпп. Сергий и Герман Валаамские чудотворцы",
						[`${year}0924`]: "Прпп. Сергий и Герман Валаамские чудотворцы (перенесение мощей)",
						[`${year}0625`]: "Прп. Арсений Коневский",
						[`${year}0430`]: "Прп. Александр Свирский",
						[`${year}0912`]: "Прп. Александр Свирский",
						[`${dateLeapYear(year, '03', '05', '04')}`]: "34 преподобномученика Валаамских",
						[`${dateLeapYear(year, '03', '08', '07')}`]: "Прп. Назарий Валаамский, Саровский",
						[`${year}0809`]: "Прп. Герман Аляскинский",
						[`${year}1128`]: "Прп. Герман Аляскинский",
						[`${year}0513`]: "Свт. Игнатий (Брянчанинов)",
						[`${year}0123`]: "Прп. Антипа Валаамский, Афонский",
						[`${year}1220`]: "Прмч. Андроник (Барсуков)",
						[`${year}1220`]: "Прмч. Сергий (Гальковский)",
						[`${year}0114`]: "Прмч. Иеремия (Леонов)",
						[`${year}1106`]: "Присп. Арефа (Митренин)",
						[`${year}0324`]: "Присп. Патрикий (Петров)",
						[`${year}0820`]: "Прмч. Афанасий (Егоров)",
						[`${year}0607`]: "Прмч. Таврион (Толоконцев)",
						[`${year}1220`]: "Прмч. Галактион (Урбанович – Новиков)",
						[`${year}1206`]: "Блгв. вел. кн. Александр Невский",
						/*[formatEndOfWeek(`${year}0819`)]: "Прп. Илия Верхотурский"*/
					}
				}]
			};
			break;

			case 'fasting':
			data = {
				title: 'Посты',
				description: `
				В Русской Православной Церкви существует четыре многодневных поста,
				посты в среду и пятницу в течение всего года (за исключением пяти седмиц),
				три однодневных поста.
				`,
				holidays: [
					{
						name: "Многодневные посты",
						items: {
							[beforeEaster(year, 48)]: "Великий пост (начало)",
							[beforeEaster(year, 1)]: "Великий пост (конец)",
							[afterEaster(year, 57)]: "Петров пост (начало)",
							[`${year}0711`]: "Петров пост (конец)",
							[`${year}0814`]: "Успенский пост (начало)",
							[`${year}0827`]: "Успенский пост (конец)",
							[`${year}1128`]: "Рождественский пост (начало)",
							[`${year}0106`]: "Рождественский пост (конец)"
						}
					},
					{
						name: "Однодневные посты",
						desc: `Среда и пятница в течение всего года,
						за исключением сплошных седмиц и Святок
						`,
						items: {
							[`${year}0118`]: "Крещенский сочельник (Навечерие Богоявления)",
							[`${year}0911`]: "Усекновение главы Иоанна Предтечи",
							[`${year}0927`]: "Воздвижение Креста Господня"
						}
					}
				]
			};
			break;

			case 'solid':
			data = {
				title: 'Сплошные седмицы',
				description: `
				Седмица – неделя с понедельника по воскресенье.
				В эти дни нет поста в среду и пятницу.
				`,
				holidays: [
					{
						name: 'Святки',
						desc: `Святые дни между праздниками Рождества Христова и Его Крещения`,
						items: {
							[`${year}0107`]: "Начало Святок",
							[`${year}0119`]: "Конец Святок"
						}
					},
					{
						name: 'Мытаря и фарисея',
						desc: `За 2 недели до Великого Поста, начальная подготовка к посту`,
						items: {
							[beforeEaster(year, 48 + 3*7)]: "Начало седмицы Мытаря и Фарисея",
							[beforeEaster(year, 48 + 2*7 + 1)]: "Конец седмицы Мытаря и Фарисея"
						}
					},
					{
						name: 'Сырная (масленица)',
						desc: `Неделя перед Великим Постом (без мяса)`,
						items: {
							[beforeEaster(year, 48 + 7)]: "Начало Сырной седмицы",
							[beforeEaster(year, 48 + 1)]: "Конец Сырной седмицы"
						}
					},
					{
						name: 'Пасхальная (Светлая)',
						desc: `Неделя после Пасхи`,
						items: {
							[afterEaster(year, 1)]: "Начало Светлой седмицы",
							[afterEaster(year, 7)]: "Конец Светлой седмицы"
						}
					},
					{
						name: 'Троицкая',
						desc: `Неделя после Троицы`,
						items: {
							[afterEaster(year, 50)]: "Начало Троицкой седмицы",
							[afterEaster(year, 56)]: "Конец Троицкой седмицы"
						}
					}
				]
			};
			break;

			case 'commemoration':
			data = {
				title: 'Особые дни поминовения усопших',
				description: `
				Дни особого общего поминовения усопших называются родительскими субботами.
				В эти дни поминаются все от века умершие христиане.
				`,
				holidays: [{
					items: {
						[beforeEaster(year, 48 + 7 + 2)]: "Мясопустная вселенская родительская суббота",
						[beforeEaster(year, 48 - 7 - 5)]: "Родительская суббота 2-й седмицы Великого Поста",
						[beforeEaster(year, 48 - 2*7 - 5)]: "Родительская суббота 3-й седмицы Великого Поста",
						[beforeEaster(year, 48 - 3*7 - 5)]: "Родительская суббота 4-й седмицы Великого Поста",
						[afterEaster(year, 7 + 2)]: "Радоница (во вторник второй недели после Пасхи)",
						[afterEaster(year, 49 - 1)]: "Троицкая вселенская родительская суббота",
						[`${year}0509`]: "День поминовения всех погибших в период Великой Отечественной войны",
						[format(subDays(endOfWeek(parse(`${year}1103`)), 1))]: "Димитриевская родительская суббота",
					}
				}]
			};
			break;
		}

		return Object.assign(data, {type, year});
	};
</script>
