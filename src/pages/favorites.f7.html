<template>
<div class="page page-white page-favorites">
	<div class="navbar navbar-large navbar-transparent">
		<div class="navbar-bg"></div>
		<div class="navbar-inner sliding">
			{{#if canGoBack}}
			<div class="left">
				<a href="#" class="link back">
					<i class="icon icon-back"></i>
					<span class="">Назад</span>
				</a>
			</div>
			{{/if}}
			<div class="title">Избранное</div> <!-- Валаам -->
			<div class="title-large">
				<div class="title-large-text">Избранное</div>
			</div>
		</div>
	</div>
	<!--suppress HtmlUnknownAttribute -->
	<div class="page-content">
		<div class="block">
			<p>Здесь хранятся отобранные молитвы, каноны, акафисты, святые и еще кое-что другое.
			Редактируйте и составьте свое личное молитвенное правило</p>
		</div>
		{{#js_if "!this.items.length"}}
			<div class="block">
				<p>Пока Вы ничего не добавили.</p>
			</div>
		{{/js_if}}
		<div class="list media-list no-hairlines-md no-margin">
			<ul id="favoriteResult">
				{{#each items}}
					<li>
						<div class="item-content">
							<div class="item-media align-self-center"
									 @click="toggleFavorite('{{id}}')">
						<i class="icon material-icons md-only">
									{{#if isFavorite}}star{{else}}star_border{{/if}}
								</i>
					</div>
							<a href="{{url}}"
							   class="item-link item-inner panel-close"
								 data-view="{{targetView}}"
								 @mouseup="showView('{{targetView}}')">
								<div class="item-title-row">
									<div class="item-title">{{name}}</div>
								</div>
								<div class="item-subtitle">{{parents}}</div>
							</a>
						</div>
					</li>
				{{/each}}
			</ul>
		</div>
	</div>
</div>
</template>
<style scoped>
	.list .item-media {
	    min-width: auto;
	}
	.item-media .icon {
		cursor: pointer;
		color: rgb(255, 198, 32);
	}
</style>
<!--suppress JSAnnotator -->
<script>
	import favoriteManager from '../js/favorite-manager.js';
	import navbarLargeMixin from './navbar-large-mixin.js';

	let app, $el;

	export default {
		data() {
			app = this.$app;
			let items = favoriteManager
				.list()
				.map((item) => {
					item.isFavorite = true;
					item.targetView = item.url.startsWith('/prayers/text/') ? '#view-prayers' : '';
					return item;
				});
			return {
				items
			};
		},
		methods: {
			toggleFavorite(id) {
				let item = this.items.find((item) => item.id === id);
				if (!item) return;

				item.isFavorite = !item.isFavorite;

				if (item.isFavorite) {
					favoriteManager.add(id, item.type);
				} else {
					favoriteManager.remove(id);
				}
				this.$setState({items: this.items});
			},
			showView(id) {
				app.tab.show(id);
			}
	 	},
		mixins: [navbarLargeMixin],
		on: {
			pageInit(page) {
				$el = this.$el;
			},
			pageBeforeIn(e, page) {
				if (page.router.history.length > 1) {
					this.canGoBack = true;
				}
				this.$update();
			},
			pageBeforeRemove() {
				//console.log('popupBeforeRemove', arguments);
			}
		},
	};
</script>
