<template>
	<div class="page" data-name="{{id}}">

		<div class="navbar">
			<div class="navbar-inner sliding">
				{{#if name}}
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="">Назад</span>
					</a>
				</div>
				{{/if}}
				<div class="title">{{title}}</div>
				<div class="right">
					{{> "navbar-right"}}
				</div>
			</div>
		</div>

		<div class="page-content">
			<div class="page-content-tile">
			{{#if name}}
			<h2 class="block">{{name}}</h2>
			{{/if}}

			<div class="list ucase-list">
				<ul>
					{{#each items}}
					<li>
						<!--suppress HtmlUnknownTarget -->
						<a href="{{href}}" class="item-link item-content">
							<div class="item-inner">
								<div class="item-title">{{name}}</div>
							</div>
						</a>
					</li>
					{{/each}}
					<!--<li>-->
						<!--<a href="/prayers/text/72283" class="item-link item-content" data-view="#view-others">-->
							<!--<div class="item-inner">-->
								<!--<div class="item-title">Тест ссылки</div>-->
							<!--</div>-->
						<!--</a>-->
					<!--</li>-->
				</ul>
			</div>
			</div>
		</div>

	</div>
</template>
<style>
	.list .item-title {
		/*white-space: normal;*/
	}
</style>
<!--suppress JSAnnotator -->
<script>
	import {sortBy} from 'lodash-es';

	export default {
		data() {
			let app = this.$app,
					sectionId = this.$route.params.sectionId || "0",
					prayerData = {
						name: false,
						title: this.$router.view.name,
						items: []
					},
					prayers = app.dataManager.cache.prayers,
					data;

			if (!prayers)
				this.$root.showLoadError(`
					Ошибка загрузки данных<br>
					Проверьте подключение к интернету
				`);

			prayers.s.forEach((data) => {
				if (data.parent === sectionId) {
					prayerData.items.push(Object.assign(data, {
						href: '/prayers/' + data.id
					}));
				}
				if (data.id === sectionId && data.parent !== "0") {
					// prayerData.name = data.name;
					Object.assign(prayerData, {id: `PR${data.id}` , name: data.name});
				}
			});

			prayers.e
				.filter(({parent}) => parent === sectionId)
				.forEach((data) => {
					prayerData.items.push(Object.assign(data, {href: '/prayers/text/' + data.id}));
				});

			prayerData.items = sortBy(prayerData.items, ['sort', 'name']);

			return prayerData;
		}
	};
</script>
